# Miaoda æ„å»ºæŒ‡å— - å®Œæ•´æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› Miaoda æ¡Œé¢åº”ç”¨çš„å®Œæ•´æ„å»ºæ–¹æ¡ˆï¼Œç¡®ä¿ç”Ÿæˆçš„å®‰è£…åŒ…åŒ…å«å®Œæ•´çš„ Web ç•Œé¢å’Œæ‰€æœ‰å¿…è¦èµ„æºã€‚

## ğŸ” å½“å‰é—®é¢˜è¯Šæ–­

### å·²å‘ç°çš„é—®é¢˜

1. **å‰ç«¯æ„å»ºè·¯å¾„ä¸ä¸€è‡´**
   - Tauri é…ç½®æŒ‡å‘ `../web-app/dist`
   - å®é™…æ„å»ºäº§ç‰©åœ¨ `../web-app/dist-web`

2. **æ„å»ºæµç¨‹ä¸å®Œæ•´**
   - ç¼ºå°‘ç»Ÿä¸€çš„æ„å»ºè„šæœ¬
   - å‰ç«¯èµ„æºåµŒå…¥æ–¹å¼ä¸æ˜ç¡®

3. **ç‰ˆæœ¬ç®¡ç†æ··ä¹±**
   - å¤šå¤„ç‰ˆæœ¬å·ä¸åŒæ­¥
   - ç¼ºå°‘ç»Ÿä¸€çš„ç‰ˆæœ¬æ›´æ–°æœºåˆ¶

## ğŸ—ï¸ æ ‡å‡†æ„å»ºæµç¨‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿ Node.js >= 20.18.0
node --version

# é…ç½® Yarn 4.5.3
corepack enable
corepack prepare yarn@4.5.3 --activate
yarn config set -H enableImmutableInstalls false
```

### 2. ä¾èµ–å®‰è£…

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
yarn install

# æ„å»º Tauri æ’ä»¶
yarn build:tauri:plugin:api

# æ„å»ºæ ¸å¿ƒåº“
yarn build:core

# æ„å»ºæ‰©å±•
yarn build:extensions
yarn build:extensions-web
```

### 3. èµ„æºå‡†å¤‡

```bash
# ä¸‹è½½å¿…è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶
yarn download:bin

# ä¸‹è½½ä¾èµ–åº“
yarn download:lib

# å¤åˆ¶é¢„å®‰è£…èµ„æº
yarn copy:assets:tauri

# ç”Ÿæˆåº”ç”¨å›¾æ ‡
yarn build:icon
```

### 4. å‰ç«¯æ„å»º

```bash
# æ„å»º Web åº”ç”¨ï¼ˆç”Ÿæˆåˆ° dist-webï¼‰
yarn build:web-app
```

### 5. æ¡Œé¢åº”ç”¨æ„å»º

#### macOS
```bash
yarn build:tauri:darwin
# æˆ–ä½¿ç”¨ Makefile
make build
```

#### Windows
```bash
yarn build:tauri:win32
# æˆ–ä½¿ç”¨è„šæœ¬
./scripts/build-windows.sh
```

#### Linux
```bash
yarn build:tauri:linux
```

## ğŸ“¦ æ„å»ºäº§ç‰©ç»“æ„

### æ­£ç¡®çš„æ„å»ºäº§ç‰©åº”åŒ…å«ï¼š

```
miaoda.app/                      # macOS åº”ç”¨åŒ…
â”œâ”€â”€ Contents/
â”‚   â”œâ”€â”€ MacOS/
â”‚   â”‚   â”œâ”€â”€ miaoda               # ä¸»ç¨‹åºï¼ˆåŒ…å«åµŒå…¥çš„å‰ç«¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ bun                  # Bun è¿è¡Œæ—¶
â”‚   â”‚   â””â”€â”€ uv                   # UV åŒ…ç®¡ç†å™¨
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â”œâ”€â”€ icon.icns            # åº”ç”¨å›¾æ ‡
â”‚   â”‚   â””â”€â”€ resources/           # é¢„å®‰è£…èµ„æº
â”‚   â”‚       â”œâ”€â”€ pre-install/     # æ‰©å±•åŒ…
â”‚   â”‚       â””â”€â”€ LICENSE          # è®¸å¯è¯
â”‚   â””â”€â”€ Info.plist               # åº”ç”¨ä¿¡æ¯

miaoda_3.0.1_aarch64.dmg        # macOS å®‰è£…åŒ…
miaoda.app.tar.gz               # è‡ªåŠ¨æ›´æ–°åŒ…
```

## ğŸ”§ é…ç½®æ–‡ä»¶æ£€æŸ¥æ¸…å•

### 1. ç‰ˆæœ¬å·åŒæ­¥ï¼ˆ3.0.1ï¼‰
- [ ] `src-tauri/tauri.conf.json`
- [ ] `src-tauri/Cargo.toml`
- [ ] `web-app/package.json`
- [ ] `core/package.json`
- [ ] `extensions-web/package.json`
- [ ] `.env.production`

### 2. Tauri é…ç½®éªŒè¯
```json
{
  "build": {
    "frontendDist": "../web-app/dist-web",  // æ­£ç¡®çš„å‰ç«¯è·¯å¾„
    "beforeBuildCommand": "yarn build:web-app"
  }
}
```

### 3. Vite é…ç½®éªŒè¯
- ç¡®ä¿ç«¯å£é…ç½®ä¸€è‡´ï¼ˆ1420ï¼‰
- ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
- æ„å»ºè¾“å‡ºè·¯å¾„æ­£ç¡®

## ğŸš€ ä¸€é”®æ„å»ºè„šæœ¬

åˆ›å»º `build-release.sh`ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸš€ Miaoda å®Œæ•´æ„å»ºæµç¨‹å¼€å§‹..."

# 1. ç¯å¢ƒæ£€æŸ¥
echo "ğŸ“‹ æ£€æŸ¥ç¯å¢ƒ..."
node --version
yarn --version

# 2. æ¸…ç†æ—§æ„å»º
echo "ğŸ§¹ æ¸…ç†æ—§æ„å»ºäº§ç‰©..."
rm -rf web-app/dist-web
rm -rf src-tauri/target

# 3. å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
yarn install

# 4. æ„å»ºæ ¸å¿ƒç»„ä»¶
echo "ğŸ”¨ æ„å»ºæ ¸å¿ƒç»„ä»¶..."
yarn build:tauri:plugin:api
yarn build:core
yarn build:extensions
yarn build:extensions-web

# 5. ä¸‹è½½èµ„æº
echo "â¬‡ï¸ ä¸‹è½½å¿…è¦èµ„æº..."
yarn download:bin
yarn download:lib

# 6. å‡†å¤‡èµ„æº
echo "ğŸ“ å‡†å¤‡èµ„æºæ–‡ä»¶..."
yarn copy:assets:tauri
yarn build:icon

# 7. æ„å»ºå‰ç«¯
echo "ğŸŒ æ„å»ºå‰ç«¯åº”ç”¨..."
yarn build:web-app

# 8. éªŒè¯å‰ç«¯æ„å»º
if [ ! -f "web-app/dist-web/index.html" ]; then
    echo "âŒ å‰ç«¯æ„å»ºå¤±è´¥ï¼"
    exit 1
fi

# 9. æ„å»º Tauri åº”ç”¨
echo "ğŸ¦€ æ„å»ºæ¡Œé¢åº”ç”¨..."
yarn build:tauri

echo "âœ… æ„å»ºå®Œæˆï¼"
echo "ğŸ“¦ å®‰è£…åŒ…ä½ç½®ï¼š"
echo "  - DMG: src-tauri/target/*/release/bundle/dmg/"
echo "  - App: src-tauri/target/*/release/bundle/macos/"
```

## ğŸ“ æ„å»ºéªŒè¯æ¸…å•

### æ„å»ºå‰æ£€æŸ¥
- [ ] æ‰€æœ‰ç‰ˆæœ¬å·å·²åŒæ­¥
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®
- [ ] ç¯å¢ƒå˜é‡å·²è®¾ç½®

### æ„å»ºåéªŒè¯
- [ ] å‰ç«¯æ–‡ä»¶å·²æ­£ç¡®åµŒå…¥
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] ç•Œé¢æ˜¾ç¤ºæ­£å¸¸ï¼ˆéé”™è¯¯é¡µé¢ï¼‰
- [ ] æ‰©å±•å·²æ­£ç¡®åŒ…å«
- [ ] è‡ªåŠ¨æ›´æ–°åŠŸèƒ½æ­£å¸¸

## ğŸ”„ æŒç»­é›†æˆå»ºè®®

### GitHub Actions å·¥ä½œæµ

1. **è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†**
   - ä½¿ç”¨ semantic-release
   - è‡ªåŠ¨æ›´æ–°æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·

2. **å¤šå¹³å°å¹¶è¡Œæ„å»º**
   - macOS: `macos-latest`
   - Windows: `windows-latest`
   - Linux: `ubuntu-latest`

3. **æ„å»ºäº§ç‰©ä¸Šä¼ **
   - è‡ªåŠ¨åˆ›å»º GitHub Release
   - ä¸Šä¼ æ‰€æœ‰å¹³å°å®‰è£…åŒ…
   - ç”Ÿæˆæ›´æ–°æ¸…å•ï¼ˆlatest.jsonï¼‰

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### 1. "Miaoda Web - Build Failed" é”™è¯¯
**åŸå› **ï¼šå‰ç«¯æ„å»ºå¤±è´¥æˆ–è·¯å¾„é…ç½®é”™è¯¯
**è§£å†³**ï¼š
```bash
# é‡æ–°æ„å»ºå‰ç«¯
yarn build:web-app
# æ£€æŸ¥ dist-web ç›®å½•
ls -la web-app/dist-web/
```

### 2. å‰ç«¯æ–‡ä»¶æœªåŒ…å«åœ¨åº”ç”¨åŒ…ä¸­
**åŸå› **ï¼šTauri 2.0 å°†å‰ç«¯æ–‡ä»¶åµŒå…¥äºŒè¿›åˆ¶
**éªŒè¯**ï¼š
```bash
strings [app]/Contents/MacOS/miaoda | grep "index.html"
```

### 3. ç‰ˆæœ¬å·ä¸ä¸€è‡´
**è§£å†³**ï¼šä½¿ç”¨ç»Ÿä¸€è„šæœ¬æ›´æ–°
```bash
node scripts/update-version.js 3.0.1
```

## ğŸ“Š æ„å»ºæ€§èƒ½ä¼˜åŒ–

1. **å¹¶è¡Œæ„å»º**
   - ä½¿ç”¨ `concurrently` å¹¶è¡Œè¿è¡Œä»»åŠ¡
   - ä¼˜åŒ–ä¾èµ–å®‰è£…ç¼“å­˜

2. **å¢é‡æ„å»º**
   - ä¿ç•™ target ç›®å½•ç¼“å­˜
   - ä½¿ç”¨ sccache åŠ é€Ÿ Rust ç¼–è¯‘

3. **æ„å»ºç¼“å­˜**
   - GitHub Actions ç¼“å­˜
   - æœ¬åœ° .cache ç›®å½•

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**
   - åˆ›å»ºæ ‡å‡†åŒ–æ„å»ºè„šæœ¬
   - éªŒè¯å½“å‰æ„å»ºæµç¨‹
   - æ›´æ–° CI/CD é…ç½®

2. **çŸ­æœŸæ”¹è¿›**
   - å®ç°è‡ªåŠ¨ç‰ˆæœ¬åŒæ­¥
   - ä¼˜åŒ–æ„å»ºæ€§èƒ½
   - æ·»åŠ æ„å»ºç›‘æ§

3. **é•¿æœŸè§„åˆ’**
   - å»ºç«‹å‘å¸ƒæµç¨‹è‡ªåŠ¨åŒ–
   - å®ç°å¤šæ¸ é“åˆ†å‘
   - æ·»åŠ æ„å»ºæŒ‡æ ‡è¿½è¸ª

## ğŸ“š å‚è€ƒèµ„æº

- [Tauri 2.0 æ–‡æ¡£](https://v2.tauri.app/)
- [Jan é¡¹ç›®æ„å»ºæµç¨‹](https://github.com/menloresearch/jan)
- [Miaoda CI/CD é…ç½®](.github/workflows/)

---

**æœ€åæ›´æ–°**: 2025-09-11
**ç‰ˆæœ¬**: 3.0.1
**ç»´æŠ¤è€…**: Miaoda Team



æˆ‘å·²ç»ä¸º Miaoda é¡¹ç›®åˆ¶å®šäº†ä¸€ä¸ªå®Œæ•´çš„æ„å»ºæ–¹æ¡ˆï¼Œè§£å†³äº†æ‚¨æåˆ°çš„æ‰€æœ‰é—®é¢˜ï¼š

  ğŸ¯ æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ

  1. ğŸ“„ BUILD_GUIDE.md - å®Œæ•´çš„æ„å»ºæŒ‡å—æ–‡æ¡£
    - è¯¦ç»†çš„é—®é¢˜è¯Šæ–­
    - æ ‡å‡†åŒ–çš„æ„å»ºæµç¨‹
    - é…ç½®æ–‡ä»¶æ£€æŸ¥æ¸…å•
    - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
  2. ğŸ”§ build-release.sh - ä¸€é”®æ„å»ºè„šæœ¬
    - è‡ªåŠ¨åŒ–æ•´ä¸ªæ„å»ºæµç¨‹
    - åŒ…å«å®Œæ•´çš„é”™è¯¯æ£€æŸ¥
    - å½©è‰²æ—¥å¿—è¾“å‡º
    - æ„å»ºäº§ç‰©éªŒè¯
  3. ğŸ”„ update-version.js - ç‰ˆæœ¬åŒæ­¥å·¥å…·
    - ä¸€é”®æ›´æ–°æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·
    - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼ˆJSONã€TOMLã€ENVï¼‰
    - è‡ªåŠ¨éªŒè¯ç‰ˆæœ¬å·æ ¼å¼

  âœ… è§£å†³çš„å…³é”®é—®é¢˜

  1. å‰ç«¯æ–‡ä»¶æ­£ç¡®æ‰“åŒ…
    - ä¿®æ­£äº† frontendDist è·¯å¾„é…ç½®
    - ç¡®ä¿å‰ç«¯æ„å»ºåˆ°æ­£ç¡®ç›®å½• (dist-web)
    - éªŒè¯å‰ç«¯æ–‡ä»¶å·²åµŒå…¥äºŒè¿›åˆ¶
  2. æ ‡å‡†åŒ–æ„å»ºæµç¨‹
    - 10ä¸ªæ˜ç¡®çš„æ„å»ºæ­¥éª¤
    - æ¯æ­¥éƒ½æœ‰éªŒè¯å’Œé”™è¯¯å¤„ç†
    - æ”¯æŒå¤šå¹³å°ï¼ˆmacOSã€Windowsã€Linuxï¼‰
  3. ç‰ˆæœ¬ç®¡ç†ç»Ÿä¸€
    - æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·åŒæ­¥
    - ä¸€ä¸ªå‘½ä»¤æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬
    - é¿å…ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜

  ğŸš€ ä½¿ç”¨æ–¹æ³•

  å¿«é€Ÿæ„å»ºå‘å¸ƒç‰ˆæœ¬ï¼š

  # 1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰
  node scripts/update-version.js 3.0.1

  # 2. æ‰§è¡Œå®Œæ•´æ„å»º
  ./scripts/build-release.sh

  æ„å»ºæµç¨‹è¯´æ˜ï¼š

  1. ç¯å¢ƒå‡†å¤‡ - æ£€æŸ¥ Node.jsã€Yarnã€Rust
  2. ä¾èµ–å®‰è£… - å®‰è£…æ‰€æœ‰é¡¹ç›®ä¾èµ–
  3. æ ¸å¿ƒæ„å»º - æ„å»ºæ’ä»¶ã€æ ¸å¿ƒåº“ã€æ‰©å±•
  4. èµ„æºä¸‹è½½ - ä¸‹è½½ bunã€uv ç­‰äºŒè¿›åˆ¶æ–‡ä»¶
  5. å‰ç«¯æ„å»º - æ„å»º Web åº”ç”¨åˆ° dist-web
  6. é…ç½®éªŒè¯ - ç¡®ä¿è·¯å¾„é…ç½®æ­£ç¡®
  7. æ¡Œé¢æ„å»º - ç”Ÿæˆæœ€ç»ˆå®‰è£…åŒ…

  ğŸ“¦ æœ€ç»ˆäº§ç‰©

  æ„å»ºæˆåŠŸåï¼Œæ‚¨å°†å¾—åˆ°ï¼š

  - macOS:
    - miaoda_3.0.1_aarch64.dmg - å®‰è£…åŒ…
    - miaoda.app - åº”ç”¨ç¨‹åºåŒ…
    - miaoda.app.tar.gz - è‡ªåŠ¨æ›´æ–°åŒ…
  - Windows:
    - miaoda_3.0.1_x64.msi - å®‰è£…ç¨‹åº
    - miaoda.exe - å¯æ‰§è¡Œæ–‡ä»¶
  - Linux:
    - miaoda_3.0.1_amd64.AppImage - AppImage åŒ…
    - miaoda_3.0.1_amd64.deb - Debian åŒ…

  ğŸ” éªŒè¯è¦ç‚¹

  æ„å»ºå®Œæˆåï¼Œè¯·éªŒè¯ï¼š

  1. âœ… åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
  2. âœ… æ˜¾ç¤ºæ­£ç¡®çš„ Web ç•Œé¢ï¼ˆéé”™è¯¯é¡µé¢ï¼‰
  3. âœ… ç‰ˆæœ¬å·æ˜¾ç¤ºä¸º 3.0.1
  4. âœ… æ‰©å±•åŠŸèƒ½æ­£å¸¸å·¥ä½œ
  5. âœ… è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å¯ç”¨

  ğŸ’¡ åç»­å»ºè®®

  1. è‡ªåŠ¨åŒ– CI/CD
    - å°†æ„å»ºè„šæœ¬é›†æˆåˆ° GitHub Actions
    - è‡ªåŠ¨å‘å¸ƒåˆ° GitHub Releases
    - ç”Ÿæˆæ›´æ–°æ¸…å• (latest.json)
  2. æ€§èƒ½ä¼˜åŒ–
    - ä½¿ç”¨æ„å»ºç¼“å­˜
    - å¹¶è¡ŒåŒ–æ„å»ºæ­¥éª¤
    - ä½¿ç”¨ sccache åŠ é€Ÿ Rust ç¼–è¯‘
  3. è´¨é‡ä¿è¯
    - æ·»åŠ æ„å»ºåè‡ªåŠ¨æµ‹è¯•
    - å®ç°æ„å»ºæŒ‡æ ‡ç›‘æ§
    - å»ºç«‹å›æ»šæœºåˆ¶

  ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ ./scripts/build-release.sh æ¥ç”Ÿæˆå®Œæ•´çš„ã€åŒ…å« Web ç•Œé¢çš„å®‰è£…åŒ…äº†ï¼